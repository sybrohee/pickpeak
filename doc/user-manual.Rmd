---
title: "pickpeak User Manual"
author: "Sylvain Brohee"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{User manual}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

# Introduction
## Description
Pickpeak is a R software package that makes use of the shiny package developped by Rstudio. While some of its functions might be used outside the shiny application, pickpeak is not intended to be used in other ways than through the graphical interface.

The main tools for the analysis of capillary electrophoresis results are GeneMapper and PeakScanner, developped by Life Technologies. Pickpeak is a free open source graphical tool, which, even if not as complete as pre-existing tools cotains some of their most common features.

## Disclaimer
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following condition:

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

## Short presentation of the tool
Starting from capillary electrophoresis result files (FSA files), pickpeak can display, scale, discover and annotate the peaks.

![Pickpeak multiexperiment view](mev_intro_view.png)
![Pickpeak singleexperiment view](single_intro_view.png)


# Before running pickpeak

## Configuration files
Examples of the configuration files are available in the package.

```
system.file( "configuration_files", package = "pickpeak")
```

### Main configuration file
The purpose of this file that is called as a paramter when running pickpeak is to describe the path to the other configuration files or directory paths. It is json formatted.
```{json}
{
	"predefined_parameters":"/path/to/predefined_configuration_file",
	"datadir":"/path/to/external_data_dir"
}
```
The demo file is available here:
```
system.file( "configuration_files",'pp_localConfigShiny.json', package = 'pickpeak')
```
### Predefined configuration file (predefined_parameters)
pickpeak allows users to define the configuration criteria. According to the experiment type, the set of analysis criteria can be different.
The file is tab-delimited and must be formatted according to heareafter. This file can also be edited in the user interface.

id |	standard.dye|	Dye1|	Dye2|Dye3|	Dye4|	Dye5	|analysis_type	|ladder|
---|---------------|-------|-------|----|------|-----------|---------------|------|
paternity|	LIZ|	900|	900|	900|	900|	500|	paternity_v17|	ILS500|
xfra|	    ROX	|5000|	100|	100	|100|	100|	amplidex_xfra|	ROX1000|
HNPCC|	    ROX |	900|900	|900	|300|	500	|None|	LIZ500|
```
system.file( "configuration_files",'config','predef.tab', package = 'pickpeak')
```
### External data directory
The data directory contains two directories which in turn contains files
```
|-data
  |-dyes
    |-colors.json
    |-scales.json
  |-markers
    |-markers.tab
    |-markers_kit1.tab
    |-markers_kit2.tab
    |-markers_kit1_bins.txt
    |- ...
```
#### The dyes folder
##### colors.json
This file defines the colors selected for each dye that will be encountered in the data analysis.
```{json}
{
  "6-FAM": {
    "color": "#0101DF",
    "cval": "blue"
  },
  "VIC": {
    "color": "#31B404",
    "cval": "green"
  },  
  "NED": {
    "color": "#000000",
    "cval": "yellow"
  },  
  "PET": {
    "color": "#FF0000",
    "cval": "red"
  },  
  "LIZ": {
    "color": "#FFBF00",
    "cval": "orange"
  },
  "ROX": {
    "color": "#FF0000",
    "cval": "red"
  }, 
  "HEX": {
    "color": "#00FF00",
    "cval": "green"
  }
}
```
system.file( "configuration_files",'dyes','colors.json', package = 'pickpeak')
```
```
##### scales.json
This file defines the position of the scaling peaks that will be used to convert the migration time in molecular weights.
```{json}
{
  "LIZ500": [35, 50, 75, 100, 139, 150, 160, 200, 250, 300, 340, 350, 400, 450, 490, 500],
  "ILS500":[60, 65, 80, 100, 120, 140, 160, 180, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500],
  "LIZ120":[15, 20, 25, 35, 50, 62, 80, 110, 120],
  "LIZ600":[20, 40, 60, 80, 100, 114, 120, 140, 160, 180, 200, 214, 220, 240, 250, 260, 280, 300, 314, 320, 340, 360, 380, 400, 414, 420, 440, 460, 480, 500, 514, 520, 540, 560, 580 ,600],
  "ROX1000":[79,90,105,131,151,182,201,254,306,337,362,425,486,509,560,598,674,739,799,902,1007],
  "CFEU2":[100, 114, 120, 140, 160, 180, 200, 214, 220, 240, 250, 260, 280, 300, 314, 320, 340, 360, 380, 400, 414, 420, 440, 460, 480, 500, 514, 520, 540, 560, 580]
}
```
```
system.file( "configuration_files",'dyes','scales.json', package = 'pickpeak')
```

#### The data folder
The files that we are going to describe hereafter are not mandatary for pickpeak to run (only visualisation of the sample raw data). However, they allow a precise analysis and annotation of the peaks.
```
system.file( "configuration_files",'data',package = 'pickpeak')
```
##### markers.tab
The markers folder contains a markers.tab file that describes the other files within the directory.

analysis|	marker.file|	bin.file|	runName|
--------|--------------|------------|----------|
aneuploidies|	markers_qstr_elucigene.tab|	NA|	Aneu|
paternity_v16|	markers_PowerPlex_ESX_16_v3.0.tab|	PowerPlex_ESX_Bins_IDX_v3.0_16.txt|	Pat|
paternity_v17|	markers_PowerPlex_ESX_17_v3.0.tab|	PowerPlex_ESX_Bins_IDX_v3.0_17.txt|	Pat|
amplidex_xfra|	markers_Amplidex_FMR1.tab|	NA	|Xfra|
elucigene_muco|	markers_Elucigene_MUCO50.tab|	NA|	Muco|

The first column (analysis) contains the name of an analysis type. For a given analysis type there is an associated file containing a list of markers / systems (see hereafter) and potentially a file containing a list of bins (hereafter). If there is no bin defined for an analysis, NA is used instead of a file name. A short name (runName) can be specified for a given type of analysis.
```
system.file( "configuration_files",'data','markers.tab',package = 'pickpeak')
```
##### marker file (tab delimited)
This file contains for each dye, the position of the systems (regions targetted) together with their molecular size.

system | cytoband | start.pos | end.pos | color | dye|
------ | -------- | --------- | ------- | ----- | ---|
system1 | Xp22.22 | 68 | 112 | blue | 6-FAM|
system2 | 3p20.15 | 96.01 | 145.25 | blue | 6-FAM|
DXS3337 | 2q35 | 172.01 | 255 | green | VIC|
...
```
system.file( "configuration_files",'data','markers_example.tab',package = 'pickpeak')
```

##### bin file 
The bin file is a text file file that is delivered together wit the that also contain a ladder sample. This allows to name each annotated peak. The file format is the same as the one those can be used in the genemapper idx tool. They are generally available from the kit supplier website. The bin file is not of any use if the user does not want to specify the exact bin with a ladder sample.
```
Version	GMID-X v 1.0			
Chemistry Kit	XXXXXX			
BinSet Name	XXXXXXX
Panel Name	XXXXXXX
Marker Name	system1			
X	77.02	0.5	0.5	
Y	83.24	0.5	0.5	
Marker Name	system2			
8	90.21	0.5	0.5	virtual
9	94.5	0.5	0.5	
10	98.79	0.5	0.5	
11	103.14	0.5	0.5	
12	107.52	0.5	0.5	
13	111.87	0.5	0.5	
14	116.22	0.5	0.5	
14.3	119.47	0.5	0.4	virtual
15	120.55	0.4	0.4	
...
```

```
system.file( "configuration_files",'data','markers_bin_example.tab',package = 'pickpeak')
```


# Running pickpeak
## Console command
```
library(pickpeak)
runShinyPackageApp("/path/to/configfile.json")
```
Provided the configuration files are correct, the following image appears.
![Pickpeak first screen](load_samples.png)

To load the samples, click on the "Browse..." button in section "Select FSA file(s)". There are demonstration file within the directory ```system.file( "data","xfra",package = 'pickpeak')```
# Misceallanous
## Create a direct link on the Desktop (windows user only)




